
# 原始数据获取说明文档
**数据时间范围**: 2025年9月1日 00:00:00 UTC 至 2025年9月30日 23:59:59 UTC
**目标交易对**: ETH/USDT


## 1. Uniswap V3 交易日志

该数据用于重建 Uniswap V3 `USDT/WETH (0.05%)` 池子的瞬时价格和流动性深度。

*   **数据来源**: Google BigQuery Public Datasets
*   **数据集**: `bigquery-public-data.crypto_ethereum.logs`
*   **目标文件**: `backend/data/uniswap_logs_2025_09.json`
*   **获取方式**: 在 Google Cloud Console 的 BigQuery 页面运行 SQL 查询并导出为 JSON (JSONL) 格式。

### 1.1 关键参数
*   **合约地址**: `0x11b815efb8f581194ae79006d24e0d814b7697f6` (USDT/WETH 500 fee tier)
*   **事件签名 (Topic0)**: `0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67`

### 1.2 SQL 查询语句
```sql
SELECT
  block_timestamp,
  block_number,
  transaction_hash,
  log_index,
  -- Swap Event Signature check
  topics, 
  -- data 包含 amount0, amount1, sqrtPriceX96, liquidity, tick
  data
FROM
  `bigquery-public-data.crypto_ethereum.logs`
WHERE
  address = '0x11b815efb8f581194ae79006d24e0d814b7697f6' 
  AND DATE(block_timestamp) BETWEEN '2025-09-01' AND '2025-09-30'
  -- 仅筛选 Swap 事件
  AND topics[OFFSET(0)] = '0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67'
ORDER BY
  block_number ASC, log_index ASC
```

### 1.3 数据结构说明
导出后的 JSON 每行包含一个事件对象，后端代码主要解析 `data` 字段：
*   **`data`**:
    *   `[128:192]`: `sqrtPriceX96` (用于计算现货价格)
    *   `[192:256]`: `liquidity` (用于计算深度 $L$)


## 2. Binance 逐笔成交数据

该数据用于计算 Binance 的每秒成交量加权均价 (VWAP) 和价格波动率。

*   **数据来源**: Binance Public Data Collection (Binance Vision)
*   **数据集类别**: Spot / Monthly / Trades (注意：不是 AggTrades，是原始 Trades)
*   **目标目录**: `backend/data/split_trades/*.csv`
*   **获取方式**: 直接从官方文件服务器下载 ZIP 包，解压后进行分片处理。

### 2.1 下载路径
*   **URL**: `https://data.binance.vision/`
*   **路径**: `data/spot/monthly/trades/ETHUSDT/`
*   **文件名**: `ETHUSDT-trades-2025-09.zip` (文件大小约 6GB+)

### 2.2 预处理要求
由于原始文件过大，需执行以下预处理：
1.  **解压**: 获取 `ETHUSDT-trades-2025-09.csv`。
2.  **分片**: 运行分片脚本（如 `proc.py`），按“日期”将其拆分为 30 个较小的 CSV 文件。
3.  **存储**: 将分片后的文件存入 `backend/data/split_trades/`。

### 2.3 原始 CSV 字段定义
Binance原始 CSV **没有表头**，字段顺序如下：
1.  `id`: 交易ID
2.  `price`: 成交价格
3.  `qty`: 成交数量
4.  `quote_qty`: 成交额
5.  **`time`**: 时间戳 (**微秒单位**, e.g., `1756684800316508`)
6.  `is_buyer_maker`: 是否为主动卖单
7.  `is_best_match`: 是否为最优匹配



## 3. Ethereum Gas 费数据

该数据用于计算每一笔模拟交易的链上 Gas 成本。

*   **数据来源**: Google BigQuery Public Datasets
*   **数据集**: `bigquery-public-data.crypto_ethereum.blocks`
*   **目标文件**: `backend/data/eth_gas_fees_2025_09.csv`
*   **获取方式**: 运行 SQL 查询并导出为 CSV。

### 3.1 SQL 查询语句
```sql
SELECT
  number AS block_number,
  timestamp AS block_timestamp,
  base_fee_per_gas  -- 核心字段 (单位: Wei)
FROM
  `bigquery-public-data.crypto_ethereum.blocks`
WHERE
  DATE(timestamp) BETWEEN '2025-09-01' AND '2025-09-30'
ORDER BY
  number ASC
```

### 3.2 数据用途
后端代码会将 `block_number` 作为索引，构建一个映射表 `Map<BlockNumber, BaseFee>`。在模拟套利时，根据 Uniswap 交易所在的区块高度，查询当时的 Base Fee，并加上 Priority Fee (2 Gwei) 来估算 Gas Price。


## 4. 本地文件目录结构

为了确保 `backend/config.py` 能正确读取数据，本地目录应保持如下结构：

```text
backend/
└── data/
    ├── uniswap_logs_2025_09.json      (来源: BigQuery)
    ├── eth_gas_fees_2025_09.csv       (来源: BigQuery)
    ├── split_trades/                  (来源: Binance Vision -> 本地分片脚本)
    │   ├── trades_2025-09-01.csv
    │   ├── trades_2025-09-02.csv
    │   └── ... (共30个文件)
    └── processed_algo_b_data.pkl      (系统自动生成的缓存，非原始数据)
```